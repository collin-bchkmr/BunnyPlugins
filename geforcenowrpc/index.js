(function(L,xe,e,Le,E,c,A,f,k,V,ke,X,y,w,v,T,g,ne,Oe,re){"use strict";const{FormSection:se}=A.Forms;let ce;const $e=function(){const[t,i]=e.React.useReducer(function(o){return~o},0);ce=i;const a=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD||e.constants.Fonts.CODE_NORMAL,includeFontPadding:!1,color:w.semanticColors.TEXT_NORMAL}});return e.React.createElement(e.ReactNative.ScrollView,{style:{flex:1,marginBottom:50}},e.React.createElement(se,{title:"Live Raw Activity"},D.lastRawActivity?e.React.createElement(e.ReactNative.Text,{style:a.code},JSON.stringify(D.lastRawActivity,void 0,3)):r.settings.display?e.React.createElement(v,{variant:"text-md/semibold"},"Display activity setting is disabled. You need to actually enable it for the raw activity to show up lmao"):e.React.createElement(v,{variant:"text-md/semibold",onPress:function(){return J()}},"No last raw activity yet. Tap text to force update")),e.React.createElement(se,{title:"Info"},e.React.createElement(v,{variant:"text-md/semibold",color:"TEXT_NORMAL"},"Last raw activity update:"," ",D.lastRawActivityTimestamp?new Date(D.lastRawActivityTimestamp).toLocaleString("en-US"):"-")))};function Je(t){t.push("VendettaCustomPage",{render:$e,title:"Live RawActivity"})}const W="https://discord.com/api/v9/",{getToken:K}=T.findByProps("getToken");async function Ve(){return await(await X.safeFetch(`${W}applications?with_team_applications=true`,{headers:{authorization:K()}})).json()}async function Ue(t){return await(await X.safeFetch(`${W}oauth2/applications/${t}/assets`,{cache:"no-store",headers:{authorization:K()}})).json()}const S={};async function le(t){if(S[t])return S[t];S[t]="pending";let i=(await(await fetch(`${W}applications/0/external-assets`,{method:"POST",headers:{authorization:K(),"content-type":"application/json"},body:JSON.stringify({urls:[t]})})).json())[0].external_asset_path;return i.startsWith("https://media.discordapp.net")&&(i=i.split("/").slice(3).join("/")),S[t]=i,i}let oe;const Fe=function(){const t=e.NavigationNative.useNavigation(),[i,a]=e.React.useState(""),[o,u]=e.React.useState();oe=function(){return!n&&E.showInputAlert({title:"Custom App ID",placeholder:"123",confirmText:"Use",confirmColor:"blue",onConfirm:function(s){if(s.match(/^\s*$/))return f.showToast("App ID cannot be empty",c.getAssetIDByName("Small"));if(Number.isNaN(Number(s)))return f.showToast("Invalid app ID",c.getAssetIDByName("Small"));U({id:s})},cancelText:"Cancel"})},e.React.useEffect(function(){a("")},[]),o||Ve().then(u);let n=!1;return o?e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(A.Search,{style:{marginBottom:10},onChangeText:function(s){return a(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:o.filter(function(s){return s.name.toLowerCase().includes(i.toLowerCase())}),renderItem:function(s){const{item:l}=s;return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:function(){n||(n=!0,t.goBack(),U?.({id:l.id,name:l.name}))}},e.React.createElement(e.ReactNative.View,{style:{marginHorizontal:8,marginBottom:8,flexDirection:"row"}},e.React.createElement(e.ReactNative.Image,{source:{uri:l.icon?`https://cdn.discordapp.com/app-icons/${l.icon}/${l.icon}.png?size=64`:I.image},style:{borderRadius:8,resizeMode:"cover",aspectRatio:1}}),e.React.createElement(e.ReactNative.View,{style:{flexDirection:"column",marginLeft:8}},e.React.createElement(v,{variant:"text-md/semibold",color:"TEXT_NORMAL"},l.name),e.React.createElement(v,{variant:"text-sm/medium",color:"TEXT_MUTED",lineClamp:1},l.description))))}}):e.React.createElement(e.ReactNative.ActivityIndicator,{style:{flex:1}})};function Me(t){t.push("VendettaCustomPage",{render:Fe,title:"Select Application",headerRight:function(){return e.React.createElement(V,{style:"header",icon:c.getAssetIDByName("ic_custom_color"),onPress:function(){return oe?.()}})}})}const ue=T.findByProps("isTablet"),q=e.stylesheet.createThemedStyleSheet({card:{backgroundColor:w.semanticColors.BACKGROUND_SECONDARY,marginHorizontal:4,marginVertical:4,borderRadius:8,flex:1},cardHeader:{backgroundColor:w.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:8,borderTopRightRadius:8,paddingHorizontal:8,paddingVertical:8,width:"100%"},cardHeaderText:{...re.TextStyleSheet["text-sm/semibold"],color:w.semanticColors.TEXT_NORMAL},cardImage:{width:"100%",flex:1,borderBottomLeftRadius:8,borderBottomRightRadius:8}}),He=function(){const t=e.NavigationNative.useNavigation(),[i,a]=e.React.useState(""),[o,u]=e.React.useState();e.React.useEffect(function(){a("")}),o||Ue(ae).then(u);let n=!1;return o?e.React.createElement(e.ReactNative.FlatList,{ListEmptyComponent:e.React.createElement(A.Search,{style:{marginBottom:10},onChangeText:function(s){return a(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:o.filter(function(s){return s.name.toLowerCase().includes(i)}),numColumns:ue.isTablet?3:2,renderItem:function(s){const{item:l}=s;return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:function(){n||(n=!0,t.goBack(),te?.(l.id))},style:{width:`${ue.isTablet?1/.03:1/.02}%`,aspectRatio:1}},e.React.createElement(e.ReactNative.View,{style:q.card},e.React.createElement(e.ReactNative.View,{style:q.cardHeader},e.React.createElement(e.ReactNative.Text,{style:q.cardHeaderText},l.name)),e.React.createElement(e.ReactNative.Image,{source:{uri:`https://cdn.discordapp.com/app-assets/${ae}/${l.id}.png?size=128`}})))}}):e.React.createElement(e.ReactNative.ActivityIndicator,{style:{flex:1}})};function Ye(t){t.push("VendettaCustomPage",{render:He,title:"Select Asset"})}function de(t){const i=Math.abs(Math.floor(t/1e3)),a=Math.floor(i/3600),o=Math.floor(i/60)%60,u=i%60;return`${a?`${a.toString().padStart(2,"0")}:`:""}${o.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`}function Q(t){const i=Math.floor(t/60),a=t%60;return new Date().setHours(i,a,0,0)}function pe(t){const i=new Date(t);return i.getHours()*60+i.getMinutes()}function fe(t,i){if(t.startsWith("spotify:"))return`https://i.scdn.co/image/${t.slice(8)}`;if(t.startsWith("mp:"))return`https://media.discordapp.net/${t.slice(3)}`;if(!Number.isNaN(Number(t)))return`https://cdn.discordapp.com/app-assets/${i??"1"}/${t}.png?size=56`}const ge={online:"mp:attachments/919655852724604978/1125529509723123712/s_online.png",idle:"mp:attachments/919655852724604978/1125529509467279451/s_idle.png",dnd:"mp:attachments/919655852724604978/1125529509236572301/s_dnd.png",offline:"mp:attachments/919655852724604978/1125529508980731954/s_offline.png"},P=T.findByStoreName("UserStore"),N=T.findByStoreName("SpotifyStore"),Z=T.findByStoreName("PresenceStore");var ye;(function(t){t[t.CurrentUser=0]="CurrentUser",t[t.CurrentUserPresence=1]="CurrentUserPresence"})(ye||(ye={}));const C={presence:{status:void 0,custom:void 0,spotify:null}},ee=function(t){return(t??Z.getActivities(P.getCurrentUser().id)).find(function(i){return i.type===4})},me=[{match:"{user.name}",description:"Your username",types:[0],replace:function(){return P.getCurrentUser().username}},{match:"{user.displayname}",description:"Your display name",types:[0],replace:function(){return P.getCurrentUser().globalName}},{match:"{user.status}",description:"Your status",types:[1],replace:function(){return ee()?.label??"No Status"}},{match:"{user.presence}",description:"Your presence (online/dnd/idle/invisible)",types:[1],replace:function(){return Z.getStatus(P.getCurrentUser().id)}},{match:"{spotify.track}",description:"Your playing Spotify track",types:[1],replace:function(){return N.getActivity()?.details??"No Spotify Track"}},{match:"{spotify.track.url}",description:"Your playing Spotify track's share link",types:[1],replace:function(){const t=N.getActivity()?.sync_id;return t?`https://open.spotify.com/track/${t}`:""}},{match:"{spotify.artist}",description:"Your playing Spotify track's artist(s)",types:[1],replace:function(){return(C.presence.spotify=N.getActivity())?.state??"No Spotify Track"}},{match:"{spotify.album}",description:"Your playing Spotify track's album",types:[1],replace:function(){return(C.presence.spotify=N.getActivity())?.assets?.large_text??"No Spotify Track"}}];function je(t){const i={content:t,types:[]};for(const a of me){let o;i.content=i.content.replaceAll(a.match,function(){for(const u of a.types)i.types.includes(u)||i.types.push(u);return o??(o=a.replace())})}return i}const Re=[{title:"Spotify Track Start",description:"The timestamp when your playing Spotify track started",format:"spotify.track.start",type:1,replace:function(){return(C.presence.spotify=N.getActivity())?.timestamps?.start}},{title:"Spotify Track End",description:"The timestamp when your playing Spotify track ends",format:"spotify.track.end",type:1,replace:function(){return(C.presence.spotify=N.getActivity())?.timestamps?.end}}];function ze(t){if(typeof t=="string"){const i=Re.find(function(o){return o.format===t}),a=i?.replace();return i?{timestamp:a!==void 0?pe(a):void 0,type:i.type}:{timestamp:0}}else return{timestamp:t}}const ve=[{title:"User Avatar",description:"Your avatar",format:"user.avatar",type:0,replace:function(){const t=P.getCurrentUser(),i=re.getUserAvatar({discriminator:t.discriminator,id:t.id,avatar:t.avatar});return S[i]||le(i).then(Y),`mp:${S[i]}`}},{title:"User Presence",description:"Your presence (online/idle/dnd/invisible)",format:"user.presence",type:1,replace:function(){return ge[Z.getStatus(P.getCurrentUser().id)]??ge.online}},{title:"Spotify Album Cover",description:"Your playing Spotify track's album cover",format:"spotify.album",type:1,replace:function(){return N.getActivity()?.assets?.large_image}}];function Ge(t){const i=ve.find(function(a){return a.format===t});return i?{image:i.replace(),type:i.type}:{image:t}}function Xe(t){for(const i of t)i===0?Ne("parsed.currentuser","CURRENT_USER_UPDATE",Y):i===1&&Ne("parsed.currentuserpresence","SELF_PRESENCE_STORE_UPDATE",function(a){(C.presence.status!==a.status||JSON.stringify(C.presence.custom)!==JSON.stringify(ee(a.activities))||JSON.stringify(C.presence.spotify)!==JSON.stringify(N.getActivity()))&&Y(),C.presence={status:a.status,custom:ee(a.activities),spotify:N.getActivity()}})}const{FormRow:p,FormRadioRow:We}=A.Forms,Ke=T.findByProps("DatePickerModes"),qe=function(){return e.React.createElement(e.ReactNative.View,{style:{marginBottom:16}})},B=e.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}}),_={color:"TEXT_DANGER",variant:"text-md/semibold"};function Qe(t){let{role:i,update:a}=t;return e.React.createElement(g.ActionSheet,{title:`${i} Image Variable`},ve.map(function(o){return e.React.createElement(p,{label:o.title,subLabel:o.description,trailing:e.React.createElement(p.Arrow,null),onPress:function(){a(o.format),g.hideActionSheet()}})}))}let te,ae;function he(t){let{appId:i,role:a,image:o,navigation:u,update:n}=t;return e.React.createElement(g.ActionSheet,{title:`Edit ${a} Image`},e.React.createElement(p,{label:"Set Image Variable",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_essentials_sparkle")}),trailing:e.React.createElement(p.Arrow,null),onPress:function(){return g.ActionSheet.open(Qe,{role:a,update:function(s){return n(s)}})}}),e.React.createElement(p,{label:"Use Custom Image",subLabel:"Make sure your image is in a square aspect ratio",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_link")}),onPress:function(){E.showInputAlert({title:"Enter the link to your image link",placeholder:"can be a discord attachment CDN link",confirmText:"Proxy",confirmColor:"brand",onConfirm:async function(s){const l=s.match(ne.constants.HTTP_REGEX_MULTI)?.[0];if(!l)return f.showToast("Invalid URL",c.getAssetIDByName("Small"));f.showToast("Proxying image...",c.getAssetIDByName("ic_clock"));try{n(`mp:${await le(l)}`),f.showToast("Proxied image",c.getAssetIDByName("Check"))}catch(m){console.error("[CustomRPC] ImageActionSheet->customImg proxy error!"),ne.logger.error(`ImageActionSheet->customImg proxy error!
${m.stack}`),f.showToast("Failed to proxy image",c.getAssetIDByName("Small"))}},cancelText:"Cancel"})}}),e.React.createElement(p,{label:"Select RPC Asset",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_media_channel")}),trailing:e.React.createElement(p.Arrow,null),onPress:function(){if(!i)return E.showConfirmationAlert({title:"No App Set",content:"An app must be selected in order to use RPC assets",confirmText:"Dismiss",confirmColor:"grey",onConfirm:function(){}});ae=i,te=function(s){te=void 0,n(s)},Ye(u),g.hideActionSheet()}}),o&&e.React.createElement(p,{label:e.React.createElement(v,_,"Remove Image"),leading:e.React.createElement(p.Icon,{style:B.destructiveIcon,source:c.getAssetIDByName("trash")}),onPress:function(){n(void 0),g.hideActionSheet()}}))}function be(t){let{role:i,text:a,url:o,update:u}=t;return e.React.createElement(g.ActionSheet,{title:`Edit Button ${i}`},e.React.createElement(p,{label:"Button Text",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){return O({role:`Button ${i} Text`,current:a,update:function(n){return u({text:n,url:o})}})}}),e.React.createElement(p,{label:"Button URL",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){return O({role:`Button ${i} URL`,current:o,update:function(n){return u({text:a,url:n})}})}}),o&&e.React.createElement(p,{label:e.React.createElement(v,_,"Remove Button URL"),leading:e.React.createElement(p.Icon,{style:B.destructiveIcon,source:c.getAssetIDByName("trash")}),onPress:function(){u({text:a,url:void 0}),g.hideActionSheet()}}),a&&e.React.createElement(p,{label:e.React.createElement(v,_,"Remove Button"),leading:e.React.createElement(p.Icon,{style:B.destructiveIcon,source:c.getAssetIDByName("trash")}),onPress:function(){u({text:void 0,url:void 0}),g.hideActionSheet()}}))}let U;function Ze(t){let{appId:i,appName:a,navigation:o,update:u}=t;return e.React.createElement(g.ActionSheet,{title:"Edit Application"},e.React.createElement(p,{label:"Application Name",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){return O({role:"Application Name",current:a,update:function(n){return u({id:i,name:n})}})}}),e.React.createElement(p,{label:"Select Application",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_robot_24px")}),trailing:e.React.createElement(p.Arrow,null),onPress:function(){U=function(n){U=void 0,u({id:n.id??i,name:n.name??a})},Me(o),g.hideActionSheet()}}),i&&e.React.createElement(p,{label:e.React.createElement(v,_,"Remove Application"),leading:e.React.createElement(p.Icon,{style:B.destructiveIcon,source:c.getAssetIDByName("trash")}),onPress:function(){u(void 0),g.hideActionSheet()}}))}function et(t){let{type:i,update:a}=t;const[o,u]=e.React.useState(i);return e.React.createElement(g.ActionSheet,{title:"Edit Activity Type"},...Object.values(x).filter(function(n){return typeof n=="number"}).map(function(n){return e.React.createElement(We,{label:_e[n],trailing:e.React.createElement(p.Arrow,null),selected:n===o,onPress:function(){a(n),u(n)}})}))}function Ee(t){let{role:i,update:a}=t;return e.React.createElement(g.ActionSheet,{title:`Set ${i} Time Variable`},Re.map(function(o){return e.React.createElement(p,{label:o.title,subLabel:o.description,trailing:e.React.createElement(p.Arrow,null),onPress:function(){a(o.format),g.hideActionSheet()}})}),e.React.createElement(qe,null))}function tt(t){let{start:i,end:a,update:o}=t;const u=function(n){let{role:s,onSubmit:l}=n;const m=new Date().setHours(0,0,0,0),b=new Date().setHours(23,59,59,999);g.openLazy(Promise.resolve(Ke),"DatePicker",{onSubmit:function(gt){return l(pe(gt._d.getTime()))},title:`Timestamp ${s} Time`,startDate:new Date,minimumDate:new Date(m),maximumDate:new Date(b),requireDateChanged:!1,mode:"time"})};return e.React.createElement(g.ActionSheet,{title:"Edit Timestamp"},e.React.createElement(p,{label:"Set Start Time Variable",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_essentials_sparkle")}),trailing:e.React.createElement(p.Arrow,null),onPress:function(){return g.ActionSheet.open(Ee,{role:"Start",update:function(n){return o({start:n,end:a})}})}}),typeof i!="string"&&e.React.createElement(p,{label:"Edit Start Time",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_message_edit")}),trailing:e.React.createElement(p.Arrow,null),onPress:function(){return u({role:"Start",onSubmit:function(n){return o({start:n,end:a})}})}}),i!==void 0&&e.React.createElement(p,{label:e.React.createElement(v,_,"Remove Start Time"),leading:e.React.createElement(p.Icon,{style:B.destructiveIcon,source:c.getAssetIDByName("trash")}),onPress:function(){o({start:void 0,end:a}),g.hideActionSheet()}}),e.React.createElement(p,{label:"Set End Time Variable",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_essentials_sparkle")}),trailing:e.React.createElement(p.Arrow,null),onPress:function(){return g.ActionSheet.open(Ee,{role:"End",update:function(n){return o({start:i,end:n})}})}}),typeof a!="string"&&e.React.createElement(p,{label:"Edit End Time",leading:e.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){return u({role:"End",onSubmit:function(n){return o({start:i,end:n})}})}}),a!==void 0&&e.React.createElement(p,{label:e.React.createElement(v,_,"Remove End Time"),leading:e.React.createElement(p.Icon,{style:B.destructiveIcon,source:c.getAssetIDByName("trash")}),onPress:function(){o({start:i,end:void 0}),g.hideActionSheet()}}))}const F=function(t){let{role:i,button:a,secondaryButton:o,run:u,secondaryRun:n}=t;if(De())return u();E.showConfirmationAlert({title:"Unsaved Changes",content:["You have unsaved changes in ",e.React.createElement(Oe.RichText.Bold,null,r.activity.profile),`. Are you sure you want to ${i}?`],confirmText:a,confirmColor:"red",onConfirm:u,secondaryConfirmText:o,onConfirmSecondary:function(){n?.(),u?.()},cancelText:"Cancel"})},O=function(t){let{role:i,current:a,update:o}=t;return E.showInputAlert({title:`Enter New ${i}`,initialValue:a,placeholder:`really cool ${i.toLowerCase()}`,confirmText:"Change",confirmColor:"brand",onConfirm:o,cancelText:"Cancel"})},at=T.findByStoreName("UserStore"),it=T.findByName("UserActivityContainer"),$=e.stylesheet.createThemedStyleSheet({actTypeCont:{flexDirection:"row",marginBottom:12,justifyContent:"space-between"},card:{borderWidth:1,borderRadius:8,borderColor:w.semanticColors.BACKGROUND_MODIFIER_ACCENT},card2:{alignItems:"flex-start",flexDirection:"row"},images:{position:"relative",marginRight:10},smallImageBg:{borderColor:w.semanticColors.BACKGROUND_PRIMARY,backgroundColor:w.semanticColors.BACKGROUND_PRIMARY,borderWidth:1,borderRadius:18,position:"absolute",right:-4,bottom:-4}});let Ae;function nt(t){let{edit:i,act:a}=t;const[o,u]=e.React.useReducer(function(l){return~l},0);Ae=u;const n=e.NavigationNative.useNavigation(),s=function(){u(),G?.()};return i?e.React.createElement(e.React.Fragment,null,e.React.createElement(e.ReactNative.View,{style:$.actTypeCont},e.React.createElement(v,{variant:"eyebrow",color:"TEXT_NORMAL",onPress:function(){return g.ActionSheet.open(et,{type:a.type??x.Playing,update:function(l){a.type=l,s()}})}},_e[a.type??x.Playing]," ...")),e.React.createElement(e.ReactNative.View,{style:$.card},e.React.createElement(e.ReactNative.View,{style:{padding:16}},e.React.createElement(e.ReactNative.View,{style:$.card2},e.React.createElement(e.ReactNative.View,{style:$.images},e.React.createElement(e.ReactNative.Pressable,{onPress:function(){return g.ActionSheet.open(he,{appId:a.app.id,role:"Large",image:a.assets.largeImg,navigation:n,update:function(l){a.assets.largeImg=l,s()}})}},e.React.createElement(e.ReactNative.Image,{source:{uri:fe(a.assets.largeImg??".",a.app.id)??I.image},style:{borderRadius:3,width:56,height:56}})),e.React.createElement(e.ReactNative.View,{style:$.smallImageBg},e.React.createElement(e.ReactNative.Pressable,{onPress:function(){return g.ActionSheet.open(he,{appId:a.app.id,role:"Small",image:a.assets.smallImg,navigation:n,update:function(l){a.assets.smallImg=l,s()}})}},e.React.createElement(e.ReactNative.Image,{source:{uri:fe(a.assets.smallImg??".",a.app.id)??I.image},style:{borderRadius:14,width:28,height:28}})))),e.React.createElement(e.ReactNative.View,{style:{flex:1}},e.React.createElement(v,{variant:"text-md/semibold",color:"TEXT_NORMAL",onPress:function(){return g.ActionSheet.open(Ze,{appId:a.app.id,appName:a.app.name,navigation:n,update:function(l){l?.id!==a.app.id&&(Number.isNaN(Number(a.assets.smallImg))||delete a.assets.smallImg,Number.isNaN(Number(a.assets.largeImg))||delete a.assets.largeImg),a.app.id=l?.id,a.app.name=l?.name,s()}})}},a.app.name??I.appName),e.React.createElement(v,{variant:"text-sm/normal",color:"TEXT_NORMAL",onPress:function(){return O({role:"Details",current:a.details,update:function(l){a.details=l,s()}})}},a.details??I.details),e.React.createElement(v,{variant:"text-sm/normal",color:"TEXT_NORMAL",onPress:function(){return O({role:"State",current:a.state,update:function(l){a.state=l,s()}})}},a.state??I.state),e.React.createElement(v,{variant:"text-sm/normal",color:"TEXT_NORMAL",onPress:function(){return g.ActionSheet.open(tt,{start:a.timestamps.start,end:a.timestamps.end,update:function(l){a.timestamps.start=l.start,a.timestamps.end=l.end,s()}})},liveUpdate:!0,getChildren:function(){return typeof a.timestamps.end=="string"?`{${a.timestamps.end}}`:typeof a.timestamps.end=="number"?`${de(Q(a.timestamps.end)-Date.now())} left`:typeof a.timestamps.start=="string"?`{${a.timestamps.start}}`:typeof a.timestamps.start=="number"?`${de(Date.now()-Q(a.timestamps.start))} elapsed`:I.timestamp}}))),e.React.createElement(e.ReactNative.View,{style:{marginTop:16}},e.React.createElement(A.Button,{text:a.buttons[0]?.text??I.button1,style:{backgroundColor:"grey"},size:"small",onPress:function(){return g.ActionSheet.open(be,{role:"1",text:a.buttons[0]?.text,url:a.buttons[0]?.url,update:function(l){let{text:m,url:b}=l;!m&&!b?a.buttons[0]=void 0:a.buttons[0]={text:m,url:b},s()}})}})),e.React.createElement(e.ReactNative.View,{style:{marginTop:10}},e.React.createElement(A.Button,{text:a.buttons[1]?.text??I.button2,style:{backgroundColor:"grey"},size:"small",onPress:function(){return g.ActionSheet.open(be,{role:"2",text:a.buttons[1]?.text,url:a.buttons[1]?.url,update:function(l){let{text:m,url:b}=l;!m&&!b?a.buttons[1]=void 0:a.buttons[1]={text:m,url:b},s()}})}}))))):e.React.createElement(it,{user:at.getCurrentUser(),activity:Se(a).activity})}const M={};function rt(t,i,a,o){if(M[t])return;const u={default:o,timeout:-1};M[t]=u;const n=function(){const s=i(new Date);u.timeout=setTimeout(function(){a(),n()},s-Date.now())};n()}const H={};function Ne(t,i,a,o){H[t]||(e.FluxDispatcher.subscribe(i,a),H[t]={default:o,event:i,handler:a})}function Ie(t){for(const[i,a]of Object.entries(M))(t||!a.default)&&(clearTimeout(a.timeout),delete M[i]);for(const[i,a]of Object.entries(H))(t||!a.default)&&(e.FluxDispatcher.unsubscribe(a.event,a.handler),delete H[i])}function st(){rt("auto_fix_timestamps",function(t){return t.setHours(24,0,0,0)},Y,!0)}function Y(){Ae?.(),J()}var x;(function(t){t[t.Playing=0]="Playing",t[t.Listening=2]="Listening",t[t.Watching=3]="Watching",t[t.Competing=5]="Competing"})(x||(x={}));const we=y.Joi.object({app:y.Joi.object({name:y.Joi.string().optional(),id:y.Joi.string().optional()}),state:y.Joi.string().optional(),details:y.Joi.string().optional(),timestamps:y.Joi.object({start:y.Joi.alternatives(y.Joi.string(),y.Joi.number()).optional(),end:y.Joi.alternatives(y.Joi.string(),y.Joi.number()).optional()}),assets:y.Joi.object({largeImg:y.Joi.string().optional(),smallImg:y.Joi.string().optional()}),buttons:[y.Joi.object({text:y.Joi.string(),url:y.Joi.string().optional()})],type:y.Joi.string().valid(...Object.values(x))});var Te;(function(t){t[t.Instance=1]="Instance",t[t.Join=2]="Join",t[t.Spectate=4]="Spectate",t[t.JoinRequest=8]="JoinRequest",t[t.Sync=16]="Sync",t[t.Play=32]="Play",t[t.PartyPrivacyFriends=64]="PartyPrivacyFriends",t[t.PartyPrivacyVoiceChannel=128]="PartyPrivacyVoiceChannel",t[t.Embedded=256]="Embedded"})(Te||(Te={}));function j(){return{timestamps:{},assets:{},buttons:[],app:{}}}function Se(t){const i=[],a={str:function(n){const s=je(n);for(const l of s.types)i.includes(l)||i.push(l);return s.content},tim:function(n){const s=ze(n);return s.type&&!i.includes(s.type)&&i.push(s.type),s.timestamp!==void 0?Q(s.timestamp):void 0},img:function(n){const s=Ge(n);return s.type&&!i.includes(s.type)&&i.push(s.type),s.image}};let o=X.safeFetch("http://vserver.lona-development.org:4041/status").json();const u={name:o.game.name,application_id:t.app.id??"0",type:t.type??0,flags:1,state:t.state&&a.str(t.state),details:t.details&&a.str(t.details),timestamps:{start:o.game.startTime,end:t.timestamps.end!==void 0?a.tim(t.timestamps.end):void 0},assets:{large_image:t.assets.largeImg&&a.img(t.assets.largeImg),small_image:t.assets.smallImg&&a.img(t.assets.smallImg)}};return u.assets.large_image&&u.type===0&&(u.assets.large_text="GeForce NOW"),t.buttons[0]&&(u.metadata={button_urls:t.buttons.slice(0,2).filter(function(n){return!!n.text}).map(function(n){return n.url?a.str(n.url):null})},u.buttons=t.buttons.slice(0,2).filter(function(n){return!!n.text}).map(function(n){return a.str(n.text)})),D.lastRawActivity=u,D.lastRawActivityTimestamp=Date.now(),ce?.(),{activity:u,types:i}}async function ie(t){let i={};if(Ie(),t){const a=Se(t);i=a.activity,Xe(a.types)}e.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:i,socketId:"CustomRPC@Nexpid/Bunny"})}function Ce(){return r.profiles?.[r.activity?.profile]??r.activity?.editing??j()}function J(){const t=Ce();r.settings?.display?ie(t):ie()}function De(){const t=Ce();return JSON.stringify(t)===JSON.stringify(r.activity.editing)}const{FormRadioRow:ct,FormRow:lt}=A.Forms,z={import:void 0,add:void 0},ot=function(){const t=e.NavigationNative.useNavigation(),[i,a]=e.React.useReducer(function(s){return~s},0),[o,u]=e.React.useState("");e.React.useEffect(function(){u("")},[]),z.add=function(){return E.showInputAlert({title:"Enter new profile name",placeholder:"Super Awesome RPC",confirmText:"Add",confirmColor:"brand",onConfirm:function(s){if(s.match(/^\s*$/))return f.showToast("Profile name cannot be empty",c.getAssetIDByName("Small"));if(s=s.trim(),r.profiles[s])return f.showToast("A profile with that name already exists",c.getAssetIDByName("Small"));r.profiles[s]=JSON.parse(JSON.stringify(r.activity.editing)),r.activity.profile=s,a(),f.showToast("Created profile",c.getAssetIDByName("Check"))},cancelText:"Cancel"})},z.import=async function(){let s;try{s=JSON.parse(await e.clipboard.getString())}catch{return f.showToast("Failed to parse JSON")}const l=we.validate(s);if(l.error)return f.showToast("Invalid profile data",c.getAssetIDByName("Small"));let m=0,b="Imported Profile";for(;r.profiles[b];)m++,b=`Imported Profile (${m})`;r.profiles[b]=l.value,r.activity.profile=b,a(),f.showToast("Imported profile",c.getAssetIDByName("Check"))};let n=!1;return e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(A.Search,{style:{marginBottom:10},onChangeText:function(s){return u(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.keys(r.profiles).filter(function(s){return s.toLowerCase().includes(o)}),renderItem:function(s){let{item:l}=s;return e.React.createElement(ct,{label:l,onLongPress:function(){return g.showSimpleActionSheet({key:"CardOverflow",header:{title:l,onClose:function(){return g.hideActionSheet()}},options:[{label:"Copy Profile",icon:c.getAssetIDByName("copy"),onPress:function(){e.clipboard.setString(JSON.stringify(r.profiles[l],void 0,3)),f.showToast("Copied",c.getAssetIDByName("toast_copy_link"))}},{label:"Rename Profile",icon:c.getAssetIDByName("ic_message_edit"),onPress:function(){return E.showInputAlert({title:"Enter new profile name",placeholder:"Super Awesome RPC 2.0",initialValue:l,confirmText:"Rename",confirmColor:"brand",onConfirm:function(m){if(m.match(/^\s*$/))return f.showToast("Profile name cannot be empty",c.getAssetIDByName("Small"));if(m=m.trim(),r.profiles[m])return f.showToast("A profile with that name already exists",c.getAssetIDByName("Small"));r.profiles[m]=r.profiles[l],r.activity.profile===l&&(r.activity.profile=m),delete r.profiles[l],a(),f.showToast("Renamed profile",c.getAssetIDByName("Check"))},cancelText:"Cancel"})}},{label:"Delete Profile",icon:c.getAssetIDByName("trash"),isDestructive:!0,onPress:function(){return E.showConfirmationAlert({title:"Delete Profile",content:"Are you sure you want to delete this profile? This cannot be undone.",confirmText:"Delete",confirmColor:"red",onConfirm:function(){r.activity.profile===l&&(delete r.activity.profile,r.activity.editing=j()),delete r.profiles[l],a(),G?.(),f.showToast("Deleted",c.getAssetIDByName("Check"))},cancelText:"Cancel"})}}]})},onPress:function(){if(!n){if(r.activity.profile===l)return f.showToast(`${l} is already loaded`,c.getAssetIDByName("Small"));F({role:"discard your changes",button:"Discard",run:function(){r.activity.editing=JSON.parse(JSON.stringify(r.profiles[l])),r.activity.profile=l,n=!0,t.goBack(),G?.(),f.showToast("Loaded",c.getAssetIDByName("Check"))},secondaryButton:"Save profile",secondaryRun:function(){r.profiles[r.activity.profile]=JSON.parse(JSON.stringify(r.activity.editing))}})}},trailing:e.React.createElement(lt.Arrow,null),selected:r.activity.profile===l})}})};function ut(t){t.push("VendettaCustomPage",{render:ot,title:"Profiles",headerRight:function(){return e.React.createElement(e.ReactNative.View,{style:{flexDirection:"row-reverse"}},e.React.createElement(V,{style:"header",icon:c.getAssetIDByName("ic_add_24px"),onPress:function(){return z.add?.()}}),e.React.createElement(V,{style:"header",icon:c.getAssetIDByName("ic_file_upload_24px"),onPress:function(){return z.import?.()}}))}})}const{FormSwitchRow:Pe,FormIcon:Be,FormRow:R}=A.Forms,I={image:"https://discord.com/assets/cb1043c312ec65507573c06c37f6ee63.gif",appName:"Enter App Name...",details:"Enter Details...",state:"Enter State...",timestamp:"Enter Timestamp...",button1:"Edit Button 1...",button2:"Edit Button 2..."},_e={0:"Playing",2:"Listening to",3:"Watching",5:"Competing in"};let G;function dt(){const t=e.NavigationNative.useNavigation(),[i,a]=e.React.useReducer(function(n){return~n},0);G=a,Le.useProxy(r),e.React.useEffect(function(){return r.settings.display&&J()},[JSON.stringify(r.activity.editing),r.settings.display]),ke.managePage({headerRight:function(){return e.React.createElement(V,{style:"header",icon:c.getAssetIDByName("SparklesIcon"),onPress:function(){return E.showConfirmationAlert({title:"String Variables",content:`String variables can be used in any text component
Here's the entire list:

${me.map(function(n){return`**\`${n.match}\`**
 \u2014 ${n.description}`}).join(`
`)}`,confirmText:"Dismiss",confirmColor:"brand",onConfirm:function(){}})}})}});let o=0,u;return e.React.createElement(e.React.Fragment,null,e.React.createElement(e.ReactNative.ScrollView,{style:{zIndex:1}},e.React.createElement(k.BetterTableRowGroup,{title:"Preview",onTitlePress:function(){if(r.settings.debug.enabled)r.settings.debug.visible=!r.settings.debug.visible,f.showToast(`Debug tab ${r.settings.debug.visible?"visible":"hidden"}`);else{if(u&&clearTimeout(u),u=setTimeout(function(){o=0},500),o++,o<2)return;if(o<7){const n=7-o;return f.showToast(`${n} more taps`)}else f.showToast("Behold! You can now debug!"),r.settings.debug.visible=!0,r.settings.debug.enabled=!0,a()}},icon:c.getAssetIDByName("ic_eye"),padding:r.settings.edit},e.React.createElement(nt,{edit:r.settings.edit,act:r.activity.editing})),e.React.createElement(k.BetterTableRowGroup,{title:"Settings",icon:c.getAssetIDByName("ic_cog_24px")},e.React.createElement(Pe,{label:"Edit Mode",subLabel:"Be able to edit your activity",leading:e.React.createElement(Be,{source:c.getAssetIDByName("ic_badge_staff")}),onValueChange:function(){return r.settings.edit=!r.settings.edit},value:r.settings.edit}),e.React.createElement(Pe,{label:"Display Activity",subLabel:"Show off your super awesome poggers activity to the world",leading:e.React.createElement(Be,{source:c.getAssetIDByName("ic_show_password")}),onValueChange:function(){return r.settings.display=!r.settings.display},value:r.settings.display})),e.React.createElement(k.BetterTableRowGroup,{title:"Data",icon:c.getAssetIDByName("ic_feedback")},e.React.createElement(R,{label:"Copy as JSON",leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("copy")}),onPress:function(){e.clipboard.setString(JSON.stringify(r.activity.editing,void 0,3)),f.showToast("Copied",c.getAssetIDByName("toast_copy_link"))}}),e.React.createElement(R,{label:"Load from Clipboard",leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_download_24px")}),onPress:function(){return F({role:"overwrite the activity data",button:"Overwrite",run:async function(){let n;try{n=JSON.parse(await e.clipboard.getString())}catch{return f.showToast("Failed to parse JSON",c.getAssetIDByName("Small"))}const s=we.validate(n);if(!s.error)return f.showToast("Invalid activity data",c.getAssetIDByName("Small"));r.activity.editing=s.value,delete r.activity.profile,a(),f.showToast("Loaded",c.getAssetIDByName("Check"))}})}})),e.React.createElement(k.BetterTableRowGroup,{nearby:!0},r.activity.profile&&e.React.createElement(e.React.Fragment,null,e.React.createElement(R,{label:`Save Profile${De()?"":" \u{1F534}"}`,leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){r.profiles[r.activity.profile]=JSON.parse(JSON.stringify(r.activity.editing)),f.showToast("Saved",c.getAssetIDByName("Check")),a()}}),e.React.createElement(R,{label:"Revert Profile",leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){return F({role:"revert",button:"Revert",run:function(){r.activity.editing=JSON.parse(JSON.stringify(r.profiles[r.activity.profile])),f.showToast("Reverted",c.getAssetIDByName("Check")),a()}})}}),e.React.createElement(R,{label:"Close Profile",leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_message_edit")}),onPress:function(){return F({role:"discard your changes",button:"Discard",run:function(){r.activity.editing=j(),delete r.activity.profile,f.showToast("Closed",c.getAssetIDByName("Check")),a()},secondaryButton:"Save profile",secondaryRun:function(){r.profiles[r.activity.profile]=JSON.parse(JSON.stringify(r.activity.editing))}})}})),e.React.createElement(R,{label:"Browse Profiles",leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_message_edit")}),trailing:e.React.createElement(R.Arrow,null),onPress:function(){return ut(t)}})),r.settings.debug.visible&&e.React.createElement(k.BetterTableRowGroup,{title:"Debug",icon:c.getAssetIDByName("ic_progress_wrench_24px")},e.React.createElement(R,{label:"Live RawActivity View",trailing:e.React.createElement(R.Arrow,null),leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_badge_staff")}),onPress:function(){return Je(t)}}),e.React.createElement(R,{label:"Flush MP Cache",leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_badge_staff")}),onPress:function(){let n=0;for(const l of Object.keys(S))n++,delete S[l];const s=":P,:3,:D,:-D,:>,x3,xD,:x,:^),:v".split(",");f.showToast(`Flushed MP cache ${s[Math.floor(Math.random()*s.length)]}`),n>0&&J()}})),e.React.createElement(e.ReactNative.View,{style:{marginBottom:20}})))}//! for some reason the compiler breaks here and doesn't recognize ActivityType
const pt={"Vendetta Advertisement":{state:"Join Now",details:'"The best Discord client for mobile"',app:{name:"Vendetta"},timestamps:{},assets:{largeImg:"mp:external/1Hoxz2ijw0uHYRKT1DDAYvEDsOTkOTT6Le4YIoX7Joo/%3Fsize%3D128/https/cdn.discordapp.com/icons/1015931589865246730/5f8c26072398178c3fb6868124eeef59.png"},type:3,buttons:[{text:"Join Vendetta",url:"https://discord.gg/vendetta-mod"},{text:"Install Vendetta",url:"https://github.com/vendetta-mod/Vendetta#installing"}]},"Scuffed Spotify Activity":{timestamps:{start:"spotify.track.start",end:"spotify.track.end"},assets:{smallImg:"user.avatar",largeImg:"spotify.album"},buttons:[{text:"Listen Along",url:"{spotify.track.url}"}],app:{name:"{spotify.track}"},type:2,details:"by {spotify.artist}",state:"on {spotify.album}"},"My Profile":{timestamps:{start:0},assets:{largeImg:"user.avatar",smallImg:"user.presence"},buttons:[],app:{name:"{user.displayname}"},type:3,details:"{user.name}",state:"{user.status}"}},r=xe.storage,D={lastRawActivity:void 0,lastRawActivityTimestamp:void 0};var ft={onLoad:async function(){r.settings??={edit:!1,display:!1,debug:{enabled:!1,visible:!1}},r.activity??={editing:j()},r.profiles??=pt,J(),st()},onUnload:function(){ie(),Ie(!0)},settings:dt};return L.debug=D,L.default=ft,L.vstorage=r,Object.defineProperty(L,"__esModule",{value:!0}),L})({},vendetta.plugin,vendetta.metro.common,vendetta.storage,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,BetterTableRow,h,ui$1,vendetta.utils,deps,vendetta.ui,d,vendetta.metro,ActionSheet,vendetta,RichText,types);
